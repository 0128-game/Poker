<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒ‰ãƒ­ãƒ¼ãƒãƒ¼ã‚«ãƒ¼ (CPU 3åå¯¾æˆ¦)</title>
    <style>
        /* CSS: æ¥•å††é…ç½®ã¨ã‚«ãƒ¼ãƒ‰ã®éè¡¨ç¤ºåŒ– */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #212121; /* èƒŒæ™¯è‰²ã‚’æš—ã */
            color: #fff;
            padding: 20px;
            text-align: center;
        }
        #poker-table {
            position: relative;
            width: 800px;
            height: 500px;
            margin: 40px auto;
            border-radius: 50%; /* æ­£å††ã«è¿‘ã„æ¥•å††ãƒ†ãƒ¼ãƒ–ãƒ« */
            background-color: #1b5e20; /* ãƒãƒ¼ã‚«ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç·‘è‰² */
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢å…±é€š */
        .player-area {
            position: absolute;
            width: 180px;
            border: 2px solid #ffeb3b;
            padding: 10px;
            border-radius: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            transition: border-color 0.3s;
            text-align: left;
            font-size: 0.9em;
        }

        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨CPUã®é…ç½® (æ¥•å††çŠ¶) */
        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ (ä¸‹ä¸­å¤®) */
        #player-area {
            left: 50%;
            bottom: -50px; /* ãƒ†ãƒ¼ãƒ–ãƒ«ã®å¤–å´ã¸ */
            transform: translateX(-50%);
            border-color: #42a5f5 !important;
        }

        /* CPU 1 (å·¦ä¸Š) */
        #cpu1-area {
            top: 50px;
            left: 50px;
        }
        /* CPU 2 (ä¸Šä¸­å¤®) */
        #cpu2-area {
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
        /* CPU 3 (å³ä¸Š) */
        #cpu3-area {
            top: 50px;
            right: 50px;
        }
        
        /* ã‚«ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
        .hand {
            height: 70px; /* ã‚«ãƒ¼ãƒ‰ã®é«˜ã•ã«åˆã‚ã›ã‚‹ */
            margin-top: 5px;
            display: flex;
            justify-content: flex-start;
        }
        .player-hand .card, .cpu-hand .card {
            display: inline-block;
            width: 50px;
            height: 70px;
            border: 1px solid #000;
            border-radius: 4px;
            margin-right: 3px;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            background-color: #f0f0f0;
            color: #000;
            cursor: pointer;
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
            line-height: 0.7;
            padding-top: 10px;
            box-sizing: border-box; /* paddingã‚’å«ã‚ãŸã‚µã‚¤ã‚ºè¨ˆç®— */
        }
        .selected-card {
            border: 3px solid #f44336 !important; /* äº¤æ›å¯¾è±¡ã®ã‚«ãƒ¼ãƒ‰ã®æ  */
        }
        .card.back {
            background-color: #c62828; /* è£é¢ã®ã‚«ãƒ¼ãƒ‰ã®è‰² */
            color: transparent;
            font-size: 0;
            cursor: default !important; /* CPUã‚«ãƒ¼ãƒ‰ã¯ã‚¯ãƒªãƒƒã‚¯ä¸å¯ã« */
            padding-top: 0;
        }
        .card.back::before {
             content: "â™£ï¸";
             display: block;
             font-size: 20px;
             line-height: 70px;
             color: white;
             text-align: center;
        }
        
        /* ãã®ä»–ã®è¦ç´  */
        #message {
            margin-top: 20px;
            padding: 10px;
            background-color: #3f51b5;
            border-radius: 5px;
            font-size: 18px;
            text-align: center;
            width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        .red-suit { color: red; }
        .black-suit { color: black; }

        /* ãƒ™ãƒƒãƒˆãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ */
        #action-area {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .action-area button, #risk-selection button, #bet-amount-area button {
            padding: 8px 12px;
            margin: 3px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        #pot-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 15px 30px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 1.2em;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <h1>â™ ï¸ ãƒ‰ãƒ­ãƒ¼ãƒãƒ¼ã‚«ãƒ¼ (ä»®æƒ³ãƒãƒƒãƒ—) â™¦ï¸</h1>

        <div id="risk-selection">
            <p><strong>ã‚²ãƒ¼ãƒ é–‹å§‹: åˆæœŸãƒãƒƒãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„</strong></p>
            <button onclick="startGame(1000)" style="background-color: #4caf50;">å°‘ (Low Risk: 1,000 ãƒãƒƒãƒ—)</button>
            <button onclick="startGame(5000)" style="background-color: #ff9800;">ä¸­ (Medium Risk: 5,000 ãƒãƒƒãƒ—)</button>
            <button onclick="startGame(10000)" style="background-color: #f44336;">å¤š (High Risk: 10,000 ãƒãƒƒãƒ—)</button>
        </div>
        
        <div id="poker-table">
            <div id="pot-display" style="display:none;">
                <p>ãƒãƒƒãƒˆ: <span id="pot-amount">0</span> ãƒãƒƒãƒ—</p>
            </div>

            <div id="cpu1-area" class="player-area" style="display:none;">
                <h3>CPU 1: <span id="cpu1-chips">0</span> ãƒãƒƒãƒ—</h3>
                <div id="cpu1-hand" class="cpu-hand hand"></div>
                <p id="cpu1-action"></p>
            </div>
            
            <div id="cpu2-area" class="player-area" style="display:none;">
                <h3>CPU 2: <span id="cpu2-chips">0</span> ãƒãƒƒãƒ—</h3>
                <div id="cpu2-hand" class="cpu-hand hand"></div>
                <p id="cpu2-action"></p>
            </div>

            <div id="cpu3-area" class="player-area" style="display:none;">
                <h3>CPU 3: <span id="cpu3-chips">0</span> ãƒãƒƒãƒ—</h3>
                <div id="cpu3-hand" class="cpu-hand hand"></div>
                <p id="cpu3-action"></p>
            </div>

            <div id="player-area" class="player-area" style="display:none; border-color: #42a5f5;">
                <h3>ğŸ§‘ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼: <span id="player-chips">0</span> ãƒãƒƒãƒ—</h3>
                <div id="player-hand" class="player-hand hand"></div>
                <p id="player-action"></p>

                <div id="action-area" style="margin-top: 15px;">
                    <div id="bet-phase-buttons">
                        <button id="check-call-button" onclick="playerAction('call')" style="background-color: #4caf50;">ã‚³ãƒ¼ãƒ« / ãƒã‚§ãƒƒã‚¯</button>
                        <button id="raise-button" onclick="showBetInput()" style="background-color: #ff9800;">ãƒ¬ã‚¤ã‚º / ãƒ™ãƒƒãƒˆ</button>
                        <button id="fold-button" onclick="playerAction('fold')" style="background-color: #f44336;">ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰</button>
                    </div>

                    <div id="bet-amount-area" style="display:none;">
                        <input type="number" id="bet-input" min="10" placeholder="ãƒ™ãƒƒãƒˆé¡" style="padding: 8px; width: 80px; margin-right: 5px; color: #000;">
                        <button onclick="playerAction('raise')" style="background-color: #2196f3;">ç¢ºå®š</button>
                        <button onclick="hideBetInput()" style="background-color: #9e9e9e;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                    
                    <div id="draw-phase-buttons" style="display:none;">
                        <button id="draw-button" onclick="playerDraw()" style="background-color: #2196f3;">äº¤æ› (é¸æŠã—ãŸã‚«ãƒ¼ãƒ‰)</button>
                        <button id="stay-button" onclick="playerStay()" style="background-color: #4caf50;">äº¤æ›ãªã— (ã‚¹ãƒ†ã‚¤)</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="message">ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚</div>

    </div>

    <script>
        // JavaScript: ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯éƒ¨åˆ†

        // =================================================================
        // 1. ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã¨å®šæ•°
        // =================================================================

        const SUITS = { H: 'â™¥', D: 'â™¦', C: 'â™£', S: 'â™ ' };
        const RANKS = ['2', '3', '4', '5', '6', '7', '8', '9', 'T', 'J', 'Q', 'K', 'A'];
        const RANK_VALUES = { '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, 'T': 10, 'J': 11, 'Q': 12, 'K': 13, 'A': 14 };
        const ANTE = 10; // å›ºå®šã®ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ï¼ˆã‚¢ãƒ³ãƒ†ã‚£ï¼‰

        let players = [];
        let deck = [];
        let pot = 0;
        let currentBet = 0;
        let currentPlayerIndex = 0;
        let dealerIndex = 0; // ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ãƒœã‚¿ãƒ³ã®ä½ç½®
        let gamePhase = 'setup'; // setup, preflop_bet, draw, postdraw_bet, showdown
        let activePlayers = [];

        // =================================================================
        // 2. DOMè¦ç´ ã®å–å¾—
        // =================================================================

        const dom = {
            riskSelection: document.getElementById('risk-selection'),
            message: document.getElementById('message'),
            playerArea: document.getElementById('player-area'),
            playerChips: document.getElementById('player-chips'),
            playerHand: document.getElementById('player-hand'),
            potAmount: document.getElementById('pot-amount'), 
            actionArea: document.getElementById('action-area'),
            betPhaseButtons: document.getElementById('bet-phase-buttons'),
            drawPhaseButtons: document.getElementById('draw-phase-buttons'),
            betAmountArea: document.getElementById('bet-amount-area'),
            betInput: document.getElementById('bet-input'),
            checkCallButton: document.getElementById('check-call-button'),
            potDisplay: document.getElementById('pot-display'), // ãƒãƒƒãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢

            cpuAreas: [
                document.getElementById('cpu1-area'),
                document.getElementById('cpu2-area'),
                document.getElementById('cpu3-area')
            ],
            cpuChips: [
                document.getElementById('cpu1-chips'),
                document.getElementById('cpu2-chips'),
                document.getElementById('cpu3-chips')
            ],
            cpuHands: [
                document.getElementById('cpu1-hand'),
                document.getElementById('cpu2-hand'),
                document.getElementById('cpu3-hand')
            ],
            cpuActions: [
                document.getElementById('cpu1-action'),
                document.getElementById('cpu2-action'),
                document.getElementById('cpu3-action')
            ]
        };

        // =================================================================
        // 3. åˆæœŸåŒ–ã¨ã‚²ãƒ¼ãƒ é–‹å§‹
        // =================================================================

        /**
         * ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã—ã€é¸æŠã•ã‚ŒãŸåˆæœŸãƒãƒƒãƒ—ã§é–‹å§‹ã—ã¾ã™ã€‚
         * @param {number} initialChips - åˆæœŸãƒãƒƒãƒ—é¡
         */
        function startGame(initialChips) {
            dom.riskSelection.style.display = 'none';
            dom.playerArea.style.display = 'block';
            dom.potDisplay.style.display = 'block'; 
            dom.message.textContent = `åˆæœŸãƒãƒƒãƒ— ${initialChips} ã§ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¾ã™ã€‚`;

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨CPUã®åˆæœŸåŒ–
            players = [];
            players.push({ 
                id: 0, 
                name: 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼', 
                chips: initialChips, 
                hand: [], 
                bet: 0, 
                status: 'active', 
                isCPU: false, 
                element: dom.playerArea, 
                chipsElement: dom.playerChips, 
                actionElement: document.getElementById('player-action'),
                cardsToDraw: [] // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®äº¤æ›é¸æŠã‚’ä¿æŒ
            });
            for (let i = 1; i <= 3; i++) {
                players.push({ 
                    id: i, 
                    name: `CPU ${i}`, 
                    chips: initialChips, 
                    hand: [], 
                    bet: 0, 
                    status: 'active', 
                    isCPU: true, 
                    element: dom.cpuAreas[i - 1],
                    chipsElement: dom.cpuChips[i - 1],
                    actionElement: dom.cpuActions[i - 1]
                });
                dom.cpuAreas[i - 1].style.display = 'block'; // CPUã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
            }

            dealerIndex = 3; // æœ€åˆã®ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã¯CPU 3ã¨ã™ã‚‹
            updateChipsDisplay();
            startNewHand();
        }

        /**
         * æ–°ã—ã„ãƒãƒ³ãƒ‰ï¼ˆãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰ã‚’é–‹å§‹ã—ã¾ã™ã€‚
         */
        function startNewHand() {
            gamePhase = 'preflop_bet';
            pot = 0;
            currentBet = 0;
            dealerIndex = (dealerIndex + 1) % players.length; // ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã‚’æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            activePlayers = [];
            players.forEach(p => {
                p.hand = [];
                p.bet = 0;
                p.status = 'active'; // active, folded, allin
                p.element.style.borderColor = p.isCPU ? '#ffeb3b' : '#42a5f5'; // ãƒœãƒ¼ãƒ€ãƒ¼è‰²ã‚’ãƒªã‚»ãƒƒãƒˆ
                if (!p.isCPU) p.cardsToDraw = [];
                p.actionElement.textContent = ''; // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
                activePlayers.push(p);
            });
            
            // ãƒ‡ãƒƒã‚­ä½œæˆï¼†ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            deck = createDeck();
            shuffleDeck(deck);

            // ã‚«ãƒ¼ãƒ‰ã‚’é…å¸ƒ
            dealCards();

            // ã‚¢ãƒ³ãƒ†ã‚£ (ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰) ã‚’æ”¯æ‰•ã†ï¼ˆå¼·åˆ¶çš„ãªæœ€åˆã®ãƒ™ãƒƒãƒˆï¼‰
            payAnte();

            // ãƒ™ãƒƒãƒˆãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹
            currentPlayerIndex = (dealerIndex + 1) % players.length; // ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã®æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
            dom.message.textContent = `**ã‚¢ãƒ³ãƒ†ã‚£ ${ANTE} ãƒãƒƒãƒ—æ”¯æ‰•ã„å®Œäº†ã€‚** ã‚«ãƒ¼ãƒ‰ãŒé…ã‚‰ã‚Œã¾ã—ãŸã€‚${players[currentPlayerIndex].name} ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚`;

            updateAllHandsDisplay(false); // è‡ªåˆ†ã®æ‰‹æœ­ã ã‘è¡¨ã€CPUã¯è£
            updatePotDisplay();
            nextAction();
        }

        // =================================================================
        // 4. ã‚«ãƒ¼ãƒ‰æ“ä½œã¨è¡¨ç¤º
        // =================================================================

        /**
         * 52æšã®ãƒˆãƒ©ãƒ³ãƒ—ãƒ‡ãƒƒã‚­ã‚’ä½œæˆã—ã¾ã™ã€‚
         */
        function createDeck() {
            const newDeck = [];
            for (const suit in SUITS) {
                RANKS.forEach(rank => {
                    newDeck.push({ suit: suit, rank: rank, value: RANK_VALUES[rank] });
                });
            }
            return newDeck;
        }

        /**
         * ãƒ‡ãƒƒã‚­ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¾ã™ (ãƒ•ã‚£ãƒƒã‚·ãƒ£ãƒ¼ãƒ»ã‚¤ã‚§ãƒ¼ãƒ„ãƒ»ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ )ã€‚
         */
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        /**
         * å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚«ãƒ¼ãƒ‰ã‚’5æšé…ã‚Šã¾ã™ã€‚
         */
        function dealCards() {
            for (let i = 0; i < 5; i++) {
                players.forEach(p => {
                    p.hand.push(deck.pop());
                });
            }
        }

        /**
         * æ‰‹æœ­å…¨ä½“ï¼ˆè¡¨/è£ï¼‰ã®è¡¨ç¤ºã‚’æ›´æ–°ã—ã¾ã™ã€‚
         * @param {boolean} showAll - ã™ã¹ã¦ã®ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ã«ã™ã‚‹ã‹ (ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³ç”¨)
         */
        function updateAllHandsDisplay(showAll) {
            players.forEach(p => {
                if (p.isCPU) {
                    // CPUã®æ‰‹æœ­ã¯ã€ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³æ™‚ (showAll=true) ä»¥å¤–ã¯å¸¸ã«è£å‘ã
                    displayHand(p.hand, p.id, showAll);
                } else {
                    displayHand(p.hand, p.id, true); // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å¸¸ã«è¡¨
                }
            });
        }

        /**
         * ç‰¹å®šã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰‹æœ­ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
         * @param {Array<Object>} hand - ã‚«ãƒ¼ãƒ‰ã®é…åˆ—
         * @param {number} playerId - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ID
         * @param {boolean} isFaceUp - ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ã«ã™ã‚‹ã‹
         */
        function displayHand(hand, playerId, isFaceUp) {
            let container;
            if (playerId === 0) {
                container = dom.playerHand;
            } else {
                container = dom.cpuHands[playerId - 1];
            }
            container.innerHTML = '';
            
            hand.forEach((card, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card' + (isFaceUp ? '' : ' back');
                
                if (isFaceUp) {
                    const suitSymbol = SUITS[card.suit];
                    const rankText = card.rank;
                    const colorClass = (card.suit === 'H' || card.suit === 'D') ? 'red-suit' : 'black-suit';
                    cardDiv.innerHTML = `<span class="${colorClass}" style="font-size: 1.5em;">${suitSymbol}</span><br>${rankText}`;

                    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰‹æœ­ã§ã®ã¿ã€äº¤æ›é¸æŠã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
                    if (playerId === 0 && gamePhase === 'draw') {
                        cardDiv.onclick = () => toggleSelected(cardDiv, index);
                    } else if (playerId === 0) {
                        cardDiv.onclick = null;
                    }
                }
                
                container.appendChild(cardDiv);
            });

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®äº¤æ›é¸æŠçŠ¶æ…‹ã‚’åæ˜ 
            if (playerId === 0 && gamePhase === 'draw') {
                const player = players[0];
                container.childNodes.forEach((cardDiv, index) => {
                    if (player.cardsToDraw.includes(index)) {
                        cardDiv.classList.add('selected-card');
                    }
                });
            }
        }

        /**
         * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã®å‡¦ç†ï¼ˆäº¤æ›å¯¾è±¡ã®é¸æŠ/è§£é™¤ï¼‰ã€‚
         */
        function toggleSelected(cardDiv, index) {
            const player = players[0];
            const isSelected = cardDiv.classList.toggle('selected-card');
            
            if (isSelected) {
                player.cardsToDraw.push(index);
            } else {
                player.cardsToDraw = player.cardsToDraw.filter(i => i !== index);
            }
        }

        // =================================================================
        // 5. ãƒãƒƒãƒ—ã¨ãƒãƒƒãƒˆã®ç®¡ç†
        // =================================================================

        /**
         * ãƒãƒƒãƒ—æ®‹é«˜ã®è¡¨ç¤ºã‚’æ›´æ–°ã—ã¾ã™ã€‚
         */
        function updateChipsDisplay() {
            players.forEach(p => {
                p.chipsElement.textContent = p.chips;
            });
        }

        /**
         * ãƒãƒƒãƒˆé¡ã®è¡¨ç¤ºã‚’æ›´æ–°ã—ã¾ã™ã€‚
         */
        function updatePotDisplay() {
            dom.potAmount.textContent = pot;
        }

        /**
         * å…¨å“¡ã‹ã‚‰ã‚¢ãƒ³ãƒ†ã‚£ï¼ˆãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ï¼‰ã‚’å¾´åã—ã¾ã™ã€‚
         */
        function payAnte() {
            players.forEach(p => {
                const anteAmount = Math.min(ANTE, p.chips);
                p.chips -= anteAmount;
                p.bet = anteAmount;
                pot += anteAmount;
            });
            currentBet = ANTE; // å…¨å“¡ãŒANTEã‚’æ‰•ã£ãŸçŠ¶æ…‹ãŒåŸºæº–ã®ãƒ™ãƒƒãƒˆé¡
            updateChipsDisplay();
        }

        /**
         * ãƒ™ãƒƒãƒˆã¾ãŸã¯ãƒ¬ã‚¤ã‚ºã§ãƒãƒƒãƒ—ã‚’æ”¯æ‰•ã„ã¾ã™ã€‚
         * @param {Object} player - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
         * @param {number} amount - æ”¯æ‰•ã†ãƒãƒƒãƒ—é¡
         */
        function payBet(player, amount) {
            const actualBet = Math.min(amount, player.chips);
            player.chips -= actualBet;
            player.bet += actualBet;
            pot += actualBet;
            updateChipsDisplay();
            updatePotDisplay();
            return actualBet;
        }

        // =================================================================
        // 6. ã‚¿ãƒ¼ãƒ³ã®é€²è¡Œ
        // =================================================================

        /**
         * æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç§»ã—ã¾ã™ã€‚
         */
        function nextAction() {
            // ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆè§£é™¤
            players.forEach(p => p.element.style.borderColor = p.isCPU ? '#ffeb3b' : '#42a5f5');

            // -----------------------------------------------------
            // çµ‚äº†æ¡ä»¶ãƒã‚§ãƒƒã‚¯
            // -----------------------------------------------------
            // ãƒ™ãƒƒãƒˆå¯èƒ½ãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ (folded/allinã§ã¯ãªã„) ã§ã€ã¾ã currentBetã«é”ã—ã¦ã„ãªã„äººãŒã„ã‚‹ã‹
            const needsAction = players.some(p => 
                p.status === 'active' && // ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰/ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ã§ã¯ãªã„
                p.chips > 0 && // ãƒãƒƒãƒ—ãŒæ®‹ã£ã¦ã„ã‚‹
                p.bet < currentBet // ã¾ã ã‚³ãƒ¼ãƒ«/ãƒ¬ã‚¤ã‚ºãŒå¿…è¦
            );

            // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå¿…è¦ãªäººãŒã„ãªã„å ´åˆã€ãƒ™ãƒƒãƒˆãƒ©ã‚¦ãƒ³ãƒ‰çµ‚äº†
            if (!needsAction) {
                if (gamePhase === 'preflop_bet') {
                    startDrawPhase();
                    return;
                } else if (gamePhase === 'postdraw_bet') {
                    startShowdown();
                    return;
                }
            }
            // -----------------------------------------------------
            
            let startLoopIndex = currentPlayerIndex;
            do {
                currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
                const p = players[currentPlayerIndex];

                // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¯èƒ½ãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ (ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰/ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ã§ã¯ãªã„)
                if (p.status === 'active' && p.chips > 0) {
                    
                    // ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                    p.element.style.borderColor = '#ff00ff';
                    
                    if (p.isCPU) {
                        // CPUã¯ã™ãã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ã¾ãŸã¯ãƒã‚§ãƒƒã‚¯ã‚’å®Œäº†ã•ã›ã‚‹
                        setTimeout(() => cpuAction(p), 1500); 
                        return;
                    } else {
                        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
                        dom.message.textContent = `**${p.name}** ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚`;
                        enablePlayerBetButtons(p);
                        return;
                    }
                }

            } while (currentPlayerIndex !== startLoopIndex); 

            // å…¨å“¡ãŒãƒã‚§ãƒƒã‚¯/ã‚³ãƒ¼ãƒ«ã—ã¦ä¸€å‘¨ã—ãŸå ´åˆ (å¿µã®ãŸã‚)
            if (!needsAction) {
                if (gamePhase === 'preflop_bet') {
                    startDrawPhase();
                } else if (gamePhase === 'postdraw_bet') {
                    startShowdown();
                }
            }
        }


        // =================================================================
        // 7. ãƒ™ãƒƒãƒˆãƒ•ã‚§ãƒ¼ã‚ºã®å‡¦ç†
        // =================================================================

        /**
         * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ™ãƒƒãƒˆãƒœã‚¿ãƒ³ã®è¡¨ç¤ºã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚
         * @param {Object} player - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
         */
        function enablePlayerBetButtons(player) {
            dom.actionArea.style.display = 'block';
            dom.betPhaseButtons.style.display = 'block';
            dom.drawPhaseButtons.style.display = 'none';
            dom.betAmountArea.style.display = 'none';

            const toCall = currentBet - player.bet;

            if (toCall === 0) {
                // ãƒã‚§ãƒƒã‚¯ã§ãã‚‹å ´åˆ
                dom.checkCallButton.textContent = 'ãƒã‚§ãƒƒã‚¯';
            } else {
                // ã‚³ãƒ¼ãƒ«ãŒå¿…è¦ãªå ´åˆ
                dom.checkCallButton.textContent = `ã‚³ãƒ¼ãƒ« (${toCall} ãƒãƒƒãƒ—)`;
                dom.checkCallButton.disabled = toCall > player.chips;
            }
            
            dom.raiseButton.disabled = false;
        }

        /**
         * ãƒ™ãƒƒãƒˆé¡å…¥åŠ›ã‚¨ãƒªã‚¢ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
         */
        function showBetInput() {
            dom.betPhaseButtons.style.display = 'none';
            dom.betAmountArea.style.display = 'block';
            
            const minRaiseAmount = currentBet > 0 ? currentBet * 2 : ANTE * 2;
            dom.betInput.value = minRaiseAmount; 
            dom.betInput.min = minRaiseAmount;
        }

        /**
         * ãƒ™ãƒƒãƒˆé¡å…¥åŠ›ã‚¨ãƒªã‚¢ã‚’éè¡¨ç¤ºã«ã—ã¾ã™ã€‚
         */
        function hideBetInput() {
            dom.betPhaseButtons.style.display = 'block';
            dom.betAmountArea.style.display = 'none';
        }


        /**
         * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‡¦ç†ã—ã¾ã™ã€‚
         * @param {string} action - 'call', 'raise', 'fold'
         */
        function playerAction(action) {
            const player = players[0];
            const toCall = currentBet - player.bet;

            switch (action) {
                case 'fold':
                    player.status = 'folded';
                    dom.message.textContent = `${player.name} ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã—ã¾ã—ãŸã€‚`;
                    player.element.style.borderColor = '#9e9e9e'; // ç°è‰²ã«
                    break;
                case 'call':
                    if (toCall > 0) {
                        payBet(player, toCall);
                        dom.message.textContent = `${player.name} ã¯ã‚³ãƒ¼ãƒ« (${toCall} ãƒãƒƒãƒ—) ã—ã¾ã—ãŸã€‚`;
                    } else {
                        // ãƒã‚§ãƒƒã‚¯
                        dom.message.textContent = `${player.name} ã¯ãƒã‚§ãƒƒã‚¯ã—ã¾ã—ãŸã€‚`;
                    }
                    if (player.chips === 0 && player.bet === currentBet) player.status = 'allin';
                    break;
                case 'raise':
                    const totalBet = parseInt(dom.betInput.value);
                    const minRaise = currentBet > 0 ? currentBet * 2 : ANTE * 2;
                    
                    if (isNaN(totalBet) || totalBet < minRaise) {
                        alert(`ãƒ™ãƒƒãƒˆé¡ã¯æœ€å° ${minRaise} ãƒãƒƒãƒ—ä»¥ä¸Šã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚`);
                        return;
                    }
                    if (totalBet > player.chips + player.bet) {
                        alert(`ãƒãƒƒãƒ—ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚æœ€å¤§ãƒ™ãƒƒãƒˆé¡ã¯ ${player.chips + player.bet} ãƒãƒƒãƒ—ã§ã™ã€‚`);
                        return;
                    }
                    
                    const amountToPay = totalBet - player.bet;
                    payBet(player, amountToPay);
                    currentBet = totalBet; // æ–°ã—ã„ãƒ™ãƒƒãƒˆé¡ã‚’è¨­å®š
                    dom.message.textContent = `${player.name} ã¯ãƒ¬ã‚¤ã‚ºã—ã€ãƒ™ãƒƒãƒˆé¡ã¯ ${currentBet} ãƒãƒƒãƒ—ã«ãªã‚Šã¾ã—ãŸã€‚`;
                    break;
            }
            
            // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã—ã€æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¸
            dom.actionArea.style.display = 'none';
            hideBetInput();
            
            // æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¸
            nextAction();
        }

        /**
         * CPUã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚³ãƒ¼ãƒ«ã€ãƒ¬ã‚¤ã‚ºã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ï¼‰ã‚’æ±ºå®šãƒ»å®Ÿè¡Œã—ã¾ã™ã€‚
         * @param {Object} cpu - CPUãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
         */
        function cpuAction(cpu) {
            const toCall = currentBet - cpu.bet;
            const actionElement = cpu.actionElement;
            actionElement.textContent = ''; 

            const handRank = evaluateHand(cpu.hand).rank;
            let actionText = '';

            if (toCall === 0) {
                // ãƒã‚§ãƒƒã‚¯å¯èƒ½ãªå ´åˆ
                if (handRank >= 4 || Math.random() < 0.2) { // å½¹ãŒå¼·ã„ã‹ã€ãŸã¾ã«ãƒ–ãƒ©ãƒ•
                    const raiseAmount = Math.min(cpu.chips, currentBet * 2 || ANTE * 2);
                    if (raiseAmount > 0) {
                        const amountToPay = raiseAmount;
                        payBet(cpu, amountToPay);
                        currentBet = cpu.bet;
                        actionText = `ãƒ¬ã‚¤ã‚º (${currentBet} ãƒãƒƒãƒ—)`;
                    } else {
                        actionText = `ãƒã‚§ãƒƒã‚¯`;
                    }
                } else {
                    actionText = `ãƒã‚§ãƒƒã‚¯`;
                }
            } else {
                // ã‚³ãƒ¼ãƒ«ãŒå¿…è¦ãªå ´åˆ
                if (toCall >= cpu.chips) {
                    // ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãŒå¿…è¦
                    if (handRank >= 5) { // ãƒ•ãƒ«ãƒã‚¦ã‚¹ä»¥ä¸Šãªã‚‰ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³
                        payBet(cpu, cpu.chips);
                        cpu.status = 'allin';
                        actionText = `ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ (${cpu.bet} ãƒãƒƒãƒ—)`;
                    } else {
                        cpu.status = 'folded';
                        actionText = `ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰`;
                        cpu.element.style.borderColor = '#9e9e9e';
                    }
                } else if (handRank >= 4 && toCall <= cpu.chips / 2) { 
                    // ãƒ„ãƒ¼ãƒšã‚¢ä»¥ä¸Šã§ã€ãƒ™ãƒƒãƒˆé¡ãŒãƒãƒƒãƒ—ã®åŠåˆ†ä»¥ä¸‹ãªã‚‰ãƒ¬ã‚¤ã‚º
                    const raiseAmount = Math.min(cpu.chips, currentBet + toCall + (ANTE * 2));
                    const amountToPay = raiseAmount - cpu.bet;
                    payBet(cpu, amountToPay);
                    currentBet = cpu.bet;
                    actionText = `ãƒ¬ã‚¤ã‚º (${currentBet} ãƒãƒƒãƒ—)`;
                } else if (handRank >= 2 || (toCall < cpu.chips * 0.1 && handRank >= 1)) { 
                    // ãƒ¯ãƒ³ãƒšã‚¢ä»¥ä¸Šã‹ã€å®‰ã‘ã‚Œã°ã‚³ãƒ¼ãƒ«
                    payBet(cpu, toCall);
                    actionText = `ã‚³ãƒ¼ãƒ« (${toCall} ãƒãƒƒãƒ—)`;
                } else {
                    // å¼±ã„æ‰‹æœ­ãªã‚‰ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰
                    cpu.status = 'folded';
                    actionText = `ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰`;
                    cpu.element.style.borderColor = '#9e9e9e';
                }
            }

            actionElement.textContent = `ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ${actionText}`;
            dom.message.textContent += ` ${cpu.name} ã¯ ${actionText} ã‚’ã—ã¾ã—ãŸã€‚`;

            // æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¸
            setTimeout(nextAction, 1000);
        }

        // =================================================================
        // 8. äº¤æ›ãƒ•ã‚§ãƒ¼ã‚ºã®å‡¦ç†
        // =================================================================

        /**
         * äº¤æ›ãƒ•ã‚§ãƒ¼ã‚ºã‚’é–‹å§‹ã—ã¾ã™ã€‚
         */
        function startDrawPhase() {
            gamePhase = 'draw';
            currentBet = 0; 
            
            // å…¨å“¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            activePlayers = players.filter(p => p.status !== 'folded');
            activePlayers.forEach(p => p.status = 'active'); 
            
            dom.message.textContent = `**äº¤æ›ãƒ•ã‚§ãƒ¼ã‚º** ã§ã™ã€‚${players[0].name} ã¯äº¤æ›ã—ãŸã„ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚`;
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒœã‚¿ãƒ³è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            dom.actionArea.style.display = 'block';
            dom.betPhaseButtons.style.display = 'none';
            dom.drawPhaseButtons.style.display = 'block';
            
            updateAllHandsDisplay(false); // CPUã‚«ãƒ¼ãƒ‰ã¯è£ã®ã¾ã¾ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ã¯ã‚¯ãƒªãƒƒã‚¯å¯èƒ½
            
            currentPlayerIndex = (dealerIndex + 1) % players.length; 
            nextDrawAction();
        }

        /**
         * æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«äº¤æ›ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç§»ã—ã¾ã™ã€‚
         */
        function nextDrawAction() {
            // ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆè§£é™¤
            players.forEach(p => p.element.style.borderColor = p.isCPU ? '#ffeb3b' : '#42a5f5');

            let startLoopIndex = currentPlayerIndex;
            do {
                currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
                const p = players[currentPlayerIndex];

                if (p.status === 'active' && p.hand.length > 0) {
                    p.element.style.borderColor = '#ff00ff';
                    
                    if (p.isCPU) {
                        setTimeout(() => cpuDraw(p), 1500); 
                        return;
                    } else {
                        dom.message.textContent = `**${p.name}** ã¯äº¤æ›ã—ãŸã„ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠã—ã€ã€Œäº¤æ›ã€ã¾ãŸã¯ã€Œäº¤æ›ãªã—ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚ï¼ˆæœ€å¤§3æšï¼‰`;
                        return;
                    }
                }
            } while (currentPlayerIndex !== startLoopIndex);
            
            // å…¨å“¡ã®äº¤æ›ãŒçµ‚ã‚ã£ãŸ
            startPostDrawBetting();
        }

        /**
         * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®äº¤æ›ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
         */
        function playerDraw() {
            const player = players[0];
            const indicesToDraw = player.cardsToDraw.sort((a, b) => b - a); 
            
            if (indicesToDraw.length > 3) {
                 alert("äº¤æ›ã§ãã‚‹ã‚«ãƒ¼ãƒ‰ã¯æœ€å¤§3æšã¾ã§ã§ã™ã€‚");
                 return;
            }

            indicesToDraw.forEach(index => {
                player.hand.splice(index, 1); 
                player.hand.push(deck.pop()); 
            });
            
            dom.message.textContent = `${player.name} ã¯ ${indicesToDraw.length} æšã®ã‚«ãƒ¼ãƒ‰ã‚’äº¤æ›ã—ã¾ã—ãŸã€‚`;
            player.cardsToDraw = []; 
            
            updateAllHandsDisplay(false);
            dom.actionArea.style.display = 'none';
            nextDrawAction();
        }

        /**
         * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒäº¤æ›ã—ãªã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
         */
        function playerStay() {
            dom.message.textContent = `${players[0].name} ã¯äº¤æ›ã›ãšã«ã‚¹ãƒ†ã‚¤ã—ã¾ã—ãŸã€‚`;
            players[0].cardsToDraw = [];
            dom.actionArea.style.display = 'none';
            nextDrawAction();
        }

        /**
         * CPUã®äº¤æ›æˆ¦ç•¥ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
         * @param {Object} cpu - CPUãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
         */
        function cpuDraw(cpu) {
            const hand = cpu.hand;
            const evaluation = evaluateHand(hand);
            let indicesToDraw = [];

            // éå¸¸ã«å˜ç´”ãªCPUæˆ¦ç•¥: 
            if (evaluation.rank === 1) { // å½¹ãªã— 
                // 3ç•ªç›®ã€4ç•ªç›®ã€5ç•ªç›®ã«å¼·ã„ã‚«ãƒ¼ãƒ‰ã‚’äº¤æ›ï¼ˆãƒˆãƒƒãƒ—2æšã¯ä¿æŒï¼‰
                const sortedHand = [...hand].sort((a, b) => b.value - a.value);
                for (let i = 2; i < 5; i++) {
                    const originalIndex = hand.findIndex(card => card.rank === sortedHand[i].rank && card.suit === sortedHand[i].suit);
                    if (originalIndex !== -1 && !indicesToDraw.includes(originalIndex)) indicesToDraw.push(originalIndex);
                }
            } else if (evaluation.rank === 2) { // ãƒ¯ãƒ³ãƒšã‚¢
                const pairRank = evaluation.details.rank;
                hand.forEach((card, index) => {
                    if (card.rank !== pairRank) indicesToDraw.push(index); 
                });
            } else {
                indicesToDraw = []; // 2ãƒšã‚¢ä»¥ä¸Šã¯äº¤æ›ã—ãªã„
            }
            
            if (indicesToDraw.length > 3) {
                indicesToDraw = indicesToDraw.slice(0, 3);
            }

            if (indicesToDraw.length > 0) {
                indicesToDraw.sort((a, b) => b - a);
                indicesToDraw.forEach(index => {
                    hand.splice(index, 1);
                    hand.push(deck.pop());
                });
                cpu.actionElement.textContent = `ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ${indicesToDraw.length} æšäº¤æ›`;
                dom.message.textContent += ` ${cpu.name} ã¯ ${indicesToDraw.length} æšäº¤æ›ã—ã¾ã—ãŸã€‚`;
            } else {
                cpu.actionElement.textContent = `ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ã‚¹ãƒ†ã‚¤`;
                dom.message.textContent += ` ${cpu.name} ã¯ã‚¹ãƒ†ã‚¤ã—ã¾ã—ãŸã€‚`;
            }
            
            updateAllHandsDisplay(false); 
            setTimeout(nextDrawAction, 1000);
        }

        // =================================================================
        // 9. ãƒã‚¹ãƒˆãƒ‰ãƒ­ãƒ¼ãƒ»ãƒ™ãƒƒãƒˆãƒ•ã‚§ãƒ¼ã‚º
        // =================================================================

        /**
         * äº¤æ›å¾Œã®ãƒ™ãƒƒãƒˆãƒ•ã‚§ãƒ¼ã‚ºã‚’é–‹å§‹ã—ã¾ã™ã€‚
         */
        function startPostDrawBetting() {
            gamePhase = 'postdraw_bet';
            currentBet = 0; 
            
            activePlayers.forEach(p => p.bet = 0); 
            
            dom.message.textContent = `**äº¤æ›å¾Œã®ãƒ™ãƒƒãƒˆãƒ•ã‚§ãƒ¼ã‚º** ã§ã™ã€‚`;
            
            currentPlayerIndex = (dealerIndex + 1) % players.length; 
            nextAction(); 
        }


        // =================================================================
        // 10. ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³ã¨å‹è€…æ±ºå®š
        // =================================================================

        /**
         * ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³ï¼ˆå‹è€…æ±ºå®šï¼‰ã‚’é–‹å§‹ã—ã¾ã™ã€‚
         */
        function startShowdown() {
            gamePhase = 'showdown';
            
            const contenders = players.filter(p => p.status !== 'folded');
            
            if (contenders.length <= 1) {
                const winner = contenders[0];
                if (winner) {
                    dom.message.textContent = `å…¨å“¡ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰ã€‚**${winner.name}** ãŒ ${pot} ãƒãƒƒãƒ—ã‚’ç²å¾—ã—ã¾ã—ãŸï¼`;
                    winner.chips += pot;
                } else {
                    dom.message.textContent = `ã‚²ãƒ¼ãƒ çµ‚äº†...`;
                }
            } else {
                contenders.forEach(p => {
                    p.evaluation = evaluateHand(p.hand);
                });

                // å‹è€…ã‚’æ±ºå®š
                contenders.sort((a, b) => compareHands(b.evaluation, a.evaluation));
                const winner = contenders[0];
                
                dom.message.textContent = `**ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³ï¼** å‹è€…ã¯ **${winner.name}** (${winner.evaluation.name}) ã§ã™ï¼ ${pot} ãƒãƒƒãƒ—ã‚’ç²å¾—ï¼`;
                winner.chips += pot;

                // å½¹ã¨æ‰‹æœ­ã‚’è¡¨ã«ã—ã¦è¡¨ç¤º
                updateAllHandsDisplay(true);
                contenders.forEach(p => {
                    p.element.style.borderColor = (p === winner) ? '#00ff00' : '#ffeb3b';
                    p.actionElement.textContent = `å½¹: ${p.evaluation.name}`;
                });
            }

            updateChipsDisplay();
            
            // æ¬¡ã®ãƒãƒ³ãƒ‰ã«é€²ã‚€ãŸã‚ã®ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            setTimeout(() => {
                dom.message.innerHTML += '<br><button onclick="startNewHand()" style="padding:10px; margin-top:10px; background-color:#3f51b5; color:white;">æ¬¡ã®ãƒãƒ³ãƒ‰ã¸</button>';
            }, 3000);
        }


        // =================================================================
        // 11. å½¹ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
        // =================================================================

        /**
         * ãƒãƒ¼ã‚«ãƒ¼ã®å½¹ã‚’åˆ¤å®šã—ã€è©•ä¾¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã—ã¾ã™ã€‚
         * @param {Array<Object>} hand - ã‚«ãƒ¼ãƒ‰ã®é…åˆ—
         * @returns {Object} å½¹ã®è©•ä¾¡ (rank, name, kickers, details)
         */
        function evaluateHand(hand) {
            const ranks = hand.map(c => c.value).sort((a, b) => a - b);
            const suits = hand.map(c => c.suit);

            const rankCounts = {};
            ranks.forEach(r => rankCounts[r] = (rankCounts[r] || 0) + 1);
            const uniqueRanks = Object.keys(rankCounts).map(Number).sort((a, b) => b - a);
            const countValues = Object.values(rankCounts).sort((a, b) => b - a);

            const isFlush = suits.every(s => s === suits[0]);
            
            // ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆåˆ¤å®š (A-5ãƒ›ã‚¤ãƒ¼ãƒ«ã‚‚è€ƒæ…®)
            let isStraight = (ranks[4] - ranks[0] === 4) && (new Set(ranks).size === 5);
            let highStraightRank = ranks[4];

            if (!isStraight && ranks.includes(14) && ranks.includes(5) && ranks.includes(4) && ranks.includes(3) && ranks.includes(2)) {
                isStraight = true;
                highStraightRank = 5; // A-5ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã®å ´åˆã®æœ€é«˜ãƒ©ãƒ³ã‚¯ã¯5ã¨è¦‹ãªã™
            }


            // å½¹ã®åˆ¤å®š (ãƒ©ãƒ³ã‚¯ãŒé«˜ã„é †)
            
            // 1. ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥ (Royal Flush) - ãƒ©ãƒ³ã‚¯10
            if (isStraight && isFlush && ranks.includes(14) && ranks.includes(13)) {
                return { rank: 10, name: "ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥", kickers: [14], details: {} };
            }
            
            // 2. ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥ (Straight Flush) - ãƒ©ãƒ³ã‚¯9
            if (isStraight && isFlush) {
                return { rank: 9, name: "ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥", kickers: [highStraightRank], details: {} };
            }
            
            // 3. ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰ (Four of a Kind) - ãƒ©ãƒ³ã‚¯8
            if (countValues[0] === 4) {
                const quadRank = uniqueRanks.find(r => rankCounts[r] === 4);
                const kicker = uniqueRanks.find(r => r !== quadRank);
                return { rank: 8, name: "ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰", kickers: [quadRank, kicker], details: {} };
            }
            
            // 4. ãƒ•ãƒ«ãƒã‚¦ã‚¹ (Full House) - ãƒ©ãƒ³ã‚¯7
            if (countValues[0] === 3 && countValues[1] === 2) {
                const threeRank = uniqueRanks.find(r => rankCounts[r] === 3);
                const pairRank = uniqueRanks.find(r => rankCounts[r] === 2);
                return { rank: 7, name: "ãƒ•ãƒ«ãƒã‚¦ã‚¹", kickers: [threeRank, pairRank], details: {} };
            }
            
            // 5. ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ (Flush) - ãƒ©ãƒ³ã‚¯6
            if (isFlush) {
                return { rank: 6, name: "ãƒ•ãƒ©ãƒƒã‚·ãƒ¥", kickers: uniqueRanks, details: {} };
            }
            
            // 6. ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ (Straight) - ãƒ©ãƒ³ã‚¯5
            if (isStraight) {
                return { rank: 5, name: "ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ", kickers: [highStraightRank], details: {} };
            }

            // 7. ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ (Three of a Kind) - ãƒ©ãƒ³ã‚¯4
            if (countValues[0] === 3) {
                const threeRank = uniqueRanks.find(r => rankCounts[r] === 3);
                const kickers = uniqueRanks.filter(r => r !== threeRank);
                return { rank: 4, name: "ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰", kickers: [threeRank, ...kickers], details: {} };
            }

            // 8. ãƒ„ãƒ¼ãƒšã‚¢ (Two Pair) - ãƒ©ãƒ³ã‚¯3
            if (countValues[0] === 2 && countValues[1] === 2) {
                const pairRanks = uniqueRanks.filter(r => rankCounts[r] === 2);
                const kicker = uniqueRanks.find(r => rankCounts[r] === 1);
                return { rank: 3, name: "ãƒ„ãƒ¼ãƒšã‚¢", kickers: [...pairRanks, kicker], details: {} };
            }

            // 9. ãƒ¯ãƒ³ãƒšã‚¢ (One Pair) - ãƒ©ãƒ³ã‚¯2
            if (countValues[0] === 2) {
                const pairRank = uniqueRanks.find(r => rankCounts[r] === 2);
                const kickers = uniqueRanks.filter(r => r !== pairRank);
                return { rank: 2, name: "ãƒ¯ãƒ³ãƒšã‚¢", kickers: [pairRank, ...kickers], details: { rank: pairRank } };
            }

            // 10. å½¹ãªã— (High Card) - ãƒ©ãƒ³ã‚¯1
            return { rank: 1, name: "å½¹ãªã— (ãƒã‚¤ã‚«ãƒ¼ãƒ‰)", kickers: uniqueRanks, details: {} };
        }

        /**
         * 2ã¤ã®æ‰‹æœ­è©•ä¾¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¯”è¼ƒã—ã¾ã™ã€‚
         * @param {Object} evalA - æ‰‹æœ­Aã®è©•ä¾¡
         * @param {Object} evalB - æ‰‹æœ­Bã®è©•ä¾¡
         * @returns {number} AãŒå‹ã¤ãªã‚‰æ­£ã€BãŒå‹ã¤ãªã‚‰è² ã€å¼•ãåˆ†ã‘ãªã‚‰0
         */
        function compareHands(evalA, evalB) {
            if (evalA.rank !== evalB.rank) {
                return evalA.rank - evalB.rank; // å½¹ã®å¼·ã•ã§æ¯”è¼ƒ
            }
            
            // å½¹ãŒåŒã˜å ´åˆã€ã‚­ãƒƒã‚«ãƒ¼ï¼ˆè£œåŠ©ã‚«ãƒ¼ãƒ‰ï¼‰ã§æ¯”è¼ƒ
            for (let i = 0; i < evalA.kickers.length; i++) {
                if (evalA.kickers[i] !== evalB.kickers[i]) {
                    return evalA.kickers[i] - evalB.kickers[i];
                }
            }
            
            return 0; // å®Œå…¨ãªå¼•ãåˆ†ã‘
        }
    </script>
</body>
</html>
